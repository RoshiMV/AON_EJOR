Sets
i suppliers /1*8/
u scenarios /1*256/

Parameters
c(i) selling price
/
1	40
2	42
3	48
4	52
5	55
6	55
7	56
8	57
/
pi(i) probability of each supplier's availability
/
1	0.78019
2	0.59798
3	0.510804
4	0.592364
5	0.881512
6	0.680883
7	0.727409
8	0.668676
/
Prob(u) Scenario probability
/
1	6.01783e-05
2	0.000121451
3	0.000160585
4	0.000324092
5	0.000128399
6	0.000259134
7	0.000342633
8	0.000691499
9	0.000447706
10	0.000903557
11	0.0011947
12	0.00241114
13	0.000955248
14	0.00192787
15	0.00254907
16	0.00514452
17	8.74493e-05
18	0.000176489
19	0.000233358
20	0.000470961
21	0.000186586
22	0.000376567
23	0.000497904
24	0.00100487
25	0.000650594
26	0.00131302
27	0.00173611
28	0.00350379
29	0.00138814
30	0.00280153
31	0.00370424
32	0.00747587
33	6.28363e-05
34	0.000126816
35	0.000167678
36	0.000338407
37	0.000134071
38	0.00027058
39	0.000357767
40	0.000722042
41	0.000467481
42	0.000943466
43	0.00124747
44	0.00251763
45	0.00099744
46	0.00201303
47	0.00266166
48	0.00537175
49	9.13118e-05
50	0.000184285
51	0.000243665
52	0.000491763
53	0.000194827
54	0.000393199
55	0.000519896
56	0.00104925
57	0.000679329
58	0.00137102
59	0.00181279
60	0.00365855
61	0.00144945
62	0.00292527
63	0.00386785
64	0.00780607
65	8.95114e-05
66	0.000180651
67	0.000238861
68	0.000482067
69	0.000190986
70	0.000385446
71	0.000509645
72	0.00102856
73	0.000665935
74	0.00134398
75	0.00177704
76	0.00358641
77	0.00142087
78	0.00286759
79	0.00379159
80	0.00765215
81	0.000130075
82	0.000262517
83	0.000347105
84	0.000700525
85	0.000277535
86	0.000560119
87	0.000740601
88	0.00149467
89	0.000967717
90	0.00195304
91	0.00258235
92	0.00521167
93	0.00206477
94	0.0041671
95	0.00550982
96	0.0111199
97	9.3465e-05
98	0.00018863
99	0.000249411
100	0.000503359
101	0.000199421
102	0.000402471
103	0.000532155
104	0.00107399
105	0.000695348
106	0.00140335
107	0.00185553
108	0.00374482
109	0.00148363
110	0.00299425
111	0.00395906
112	0.00799013
113	0.000135821
114	0.000274112
115	0.000362436
116	0.000731466
117	0.000289793
118	0.000584859
119	0.000773312
120	0.00156069
121	0.00101046
122	0.0020393
123	0.00269641
124	0.00544186
125	0.00215597
126	0.00435115
127	0.00575318
128	0.011611
129	0.000213596
130	0.000431078
131	0.000569981
132	0.00115033
133	0.00045574
134	0.00091977
135	0.00121614
136	0.0024544
137	0.00158909
138	0.00320708
139	0.00424047
140	0.00855807
141	0.00339055
142	0.00684278
143	0.00904767
144	0.0182599
145	0.000310392
146	0.00062643
147	0.000828279
148	0.00167163
149	0.000662267
150	0.00133658
151	0.00176726
152	0.00356666
153	0.00230921
154	0.00466043
155	0.00616212
156	0.0124363
157	0.00492705
158	0.00994373
159	0.0131478
160	0.0265348
161	0.000223031
162	0.000450119
163	0.000595156
164	0.00120114
165	0.000475869
166	0.000960395
167	0.00126985
168	0.00256281
169	0.00165927
170	0.00334873
171	0.00442776
172	0.00893607
173	0.00354031
174	0.00714502
175	0.00944729
176	0.0190664
177	0.000324101
178	0.000654099
179	0.000864863
180	0.00174546
181	0.000691519
182	0.00139562
183	0.00184531
184	0.0037242
185	0.00241121
186	0.00486628
187	0.00643429
188	0.0129856
189	0.00514467
190	0.0103829
191	0.0137285
192	0.0277068
193	0.000317711
194	0.000641202
195	0.00084781
196	0.00171104
197	0.000677884
198	0.0013681
199	0.00180893
200	0.00365077
201	0.00236366
202	0.00477033
203	0.00630742
204	0.0127296
205	0.00504323
206	0.0101782
207	0.0134578
208	0.0271605
209	0.000461688
210	0.000931775
211	0.00123201
212	0.00248644
213	0.000985081
214	0.00198808
215	0.00262868
216	0.00530519
217	0.00343481
218	0.0069321
219	0.00916576
220	0.0184983
221	0.00732867
222	0.0147907
223	0.0195565
224	0.0394688
225	0.000331744
226	0.000669523
227	0.000885257
228	0.00178662
229	0.000707825
230	0.00142853
231	0.00188883
232	0.00381202
233	0.00246806
234	0.00498102
235	0.00658601
236	0.0132918
237	0.00526598
238	0.0106278
239	0.0140522
240	0.0283601
241	0.00048208
242	0.000972931
243	0.00128643
244	0.00259626
245	0.00102859
246	0.00207589
247	0.00274479
248	0.00553951
249	0.00358652
250	0.00723828
251	0.0095706
252	0.0193153
253	0.00765237
254	0.0154439
255	0.0204203
256	0.0412121
/
Table
R(u,i)  availability
	1	2	3	4	5	6	7	8	
1	0	0	0	0	0	0	0	0	
2	0	0	0	0	0	0	0	1	
3	0	0	0	0	0	0	1	0	
4	0	0	0	0	0	0	1	1	
5	0	0	0	0	0	1	0	0	
6	0	0	0	0	0	1	0	1	
7	0	0	0	0	0	1	1	0	
8	0	0	0	0	0	1	1	1	
9	0	0	0	0	1	0	0	0	
10	0	0	0	0	1	0	0	1	
11	0	0	0	0	1	0	1	0	
12	0	0	0	0	1	0	1	1	
13	0	0	0	0	1	1	0	0	
14	0	0	0	0	1	1	0	1	
15	0	0	0	0	1	1	1	0	
16	0	0	0	0	1	1	1	1	
17	0	0	0	1	0	0	0	0	
18	0	0	0	1	0	0	0	1	
19	0	0	0	1	0	0	1	0	
20	0	0	0	1	0	0	1	1	
21	0	0	0	1	0	1	0	0	
22	0	0	0	1	0	1	0	1	
23	0	0	0	1	0	1	1	0	
24	0	0	0	1	0	1	1	1	
25	0	0	0	1	1	0	0	0	
26	0	0	0	1	1	0	0	1	
27	0	0	0	1	1	0	1	0	
28	0	0	0	1	1	0	1	1	
29	0	0	0	1	1	1	0	0	
30	0	0	0	1	1	1	0	1	
31	0	0	0	1	1	1	1	0	
32	0	0	0	1	1	1	1	1	
33	0	0	1	0	0	0	0	0	
34	0	0	1	0	0	0	0	1	
35	0	0	1	0	0	0	1	0	
36	0	0	1	0	0	0	1	1	
37	0	0	1	0	0	1	0	0	
38	0	0	1	0	0	1	0	1	
39	0	0	1	0	0	1	1	0	
40	0	0	1	0	0	1	1	1	
41	0	0	1	0	1	0	0	0	
42	0	0	1	0	1	0	0	1	
43	0	0	1	0	1	0	1	0	
44	0	0	1	0	1	0	1	1	
45	0	0	1	0	1	1	0	0	
46	0	0	1	0	1	1	0	1	
47	0	0	1	0	1	1	1	0	
48	0	0	1	0	1	1	1	1	
49	0	0	1	1	0	0	0	0	
50	0	0	1	1	0	0	0	1	
51	0	0	1	1	0	0	1	0	
52	0	0	1	1	0	0	1	1	
53	0	0	1	1	0	1	0	0	
54	0	0	1	1	0	1	0	1	
55	0	0	1	1	0	1	1	0	
56	0	0	1	1	0	1	1	1	
57	0	0	1	1	1	0	0	0	
58	0	0	1	1	1	0	0	1	
59	0	0	1	1	1	0	1	0	
60	0	0	1	1	1	0	1	1	
61	0	0	1	1	1	1	0	0	
62	0	0	1	1	1	1	0	1	
63	0	0	1	1	1	1	1	0	
64	0	0	1	1	1	1	1	1	
65	0	1	0	0	0	0	0	0	
66	0	1	0	0	0	0	0	1	
67	0	1	0	0	0	0	1	0	
68	0	1	0	0	0	0	1	1	
69	0	1	0	0	0	1	0	0	
70	0	1	0	0	0	1	0	1	
71	0	1	0	0	0	1	1	0	
72	0	1	0	0	0	1	1	1	
73	0	1	0	0	1	0	0	0	
74	0	1	0	0	1	0	0	1	
75	0	1	0	0	1	0	1	0	
76	0	1	0	0	1	0	1	1	
77	0	1	0	0	1	1	0	0	
78	0	1	0	0	1	1	0	1	
79	0	1	0	0	1	1	1	0	
80	0	1	0	0	1	1	1	1	
81	0	1	0	1	0	0	0	0	
82	0	1	0	1	0	0	0	1	
83	0	1	0	1	0	0	1	0	
84	0	1	0	1	0	0	1	1	
85	0	1	0	1	0	1	0	0	
86	0	1	0	1	0	1	0	1	
87	0	1	0	1	0	1	1	0	
88	0	1	0	1	0	1	1	1	
89	0	1	0	1	1	0	0	0	
90	0	1	0	1	1	0	0	1	
91	0	1	0	1	1	0	1	0	
92	0	1	0	1	1	0	1	1	
93	0	1	0	1	1	1	0	0	
94	0	1	0	1	1	1	0	1	
95	0	1	0	1	1	1	1	0	
96	0	1	0	1	1	1	1	1	
97	0	1	1	0	0	0	0	0	
98	0	1	1	0	0	0	0	1	
99	0	1	1	0	0	0	1	0	
100	0	1	1	0	0	0	1	1	
101	0	1	1	0	0	1	0	0	
102	0	1	1	0	0	1	0	1	
103	0	1	1	0	0	1	1	0	
104	0	1	1	0	0	1	1	1	
105	0	1	1	0	1	0	0	0	
106	0	1	1	0	1	0	0	1	
107	0	1	1	0	1	0	1	0	
108	0	1	1	0	1	0	1	1	
109	0	1	1	0	1	1	0	0	
110	0	1	1	0	1	1	0	1	
111	0	1	1	0	1	1	1	0	
112	0	1	1	0	1	1	1	1	
113	0	1	1	1	0	0	0	0	
114	0	1	1	1	0	0	0	1	
115	0	1	1	1	0	0	1	0	
116	0	1	1	1	0	0	1	1	
117	0	1	1	1	0	1	0	0	
118	0	1	1	1	0	1	0	1	
119	0	1	1	1	0	1	1	0	
120	0	1	1	1	0	1	1	1	
121	0	1	1	1	1	0	0	0	
122	0	1	1	1	1	0	0	1	
123	0	1	1	1	1	0	1	0	
124	0	1	1	1	1	0	1	1	
125	0	1	1	1	1	1	0	0	
126	0	1	1	1	1	1	0	1	
127	0	1	1	1	1	1	1	0	
128	0	1	1	1	1	1	1	1	
129	1	0	0	0	0	0	0	0	
130	1	0	0	0	0	0	0	1	
131	1	0	0	0	0	0	1	0	
132	1	0	0	0	0	0	1	1	
133	1	0	0	0	0	1	0	0	
134	1	0	0	0	0	1	0	1	
135	1	0	0	0	0	1	1	0	
136	1	0	0	0	0	1	1	1	
137	1	0	0	0	1	0	0	0	
138	1	0	0	0	1	0	0	1	
139	1	0	0	0	1	0	1	0	
140	1	0	0	0	1	0	1	1	
141	1	0	0	0	1	1	0	0	
142	1	0	0	0	1	1	0	1	
143	1	0	0	0	1	1	1	0	
144	1	0	0	0	1	1	1	1	
145	1	0	0	1	0	0	0	0	
146	1	0	0	1	0	0	0	1	
147	1	0	0	1	0	0	1	0	
148	1	0	0	1	0	0	1	1	
149	1	0	0	1	0	1	0	0	
150	1	0	0	1	0	1	0	1	
151	1	0	0	1	0	1	1	0	
152	1	0	0	1	0	1	1	1	
153	1	0	0	1	1	0	0	0	
154	1	0	0	1	1	0	0	1	
155	1	0	0	1	1	0	1	0	
156	1	0	0	1	1	0	1	1	
157	1	0	0	1	1	1	0	0	
158	1	0	0	1	1	1	0	1	
159	1	0	0	1	1	1	1	0	
160	1	0	0	1	1	1	1	1	
161	1	0	1	0	0	0	0	0	
162	1	0	1	0	0	0	0	1	
163	1	0	1	0	0	0	1	0	
164	1	0	1	0	0	0	1	1	
165	1	0	1	0	0	1	0	0	
166	1	0	1	0	0	1	0	1	
167	1	0	1	0	0	1	1	0	
168	1	0	1	0	0	1	1	1	
169	1	0	1	0	1	0	0	0	
170	1	0	1	0	1	0	0	1	
171	1	0	1	0	1	0	1	0	
172	1	0	1	0	1	0	1	1	
173	1	0	1	0	1	1	0	0	
174	1	0	1	0	1	1	0	1	
175	1	0	1	0	1	1	1	0	
176	1	0	1	0	1	1	1	1	
177	1	0	1	1	0	0	0	0	
178	1	0	1	1	0	0	0	1	
179	1	0	1	1	0	0	1	0	
180	1	0	1	1	0	0	1	1	
181	1	0	1	1	0	1	0	0	
182	1	0	1	1	0	1	0	1	
183	1	0	1	1	0	1	1	0	
184	1	0	1	1	0	1	1	1	
185	1	0	1	1	1	0	0	0	
186	1	0	1	1	1	0	0	1	
187	1	0	1	1	1	0	1	0	
188	1	0	1	1	1	0	1	1	
189	1	0	1	1	1	1	0	0	
190	1	0	1	1	1	1	0	1	
191	1	0	1	1	1	1	1	0	
192	1	0	1	1	1	1	1	1	
193	1	1	0	0	0	0	0	0	
194	1	1	0	0	0	0	0	1	
195	1	1	0	0	0	0	1	0	
196	1	1	0	0	0	0	1	1	
197	1	1	0	0	0	1	0	0	
198	1	1	0	0	0	1	0	1	
199	1	1	0	0	0	1	1	0	
200	1	1	0	0	0	1	1	1	
201	1	1	0	0	1	0	0	0	
202	1	1	0	0	1	0	0	1	
203	1	1	0	0	1	0	1	0	
204	1	1	0	0	1	0	1	1	
205	1	1	0	0	1	1	0	0	
206	1	1	0	0	1	1	0	1	
207	1	1	0	0	1	1	1	0	
208	1	1	0	0	1	1	1	1	
209	1	1	0	1	0	0	0	0	
210	1	1	0	1	0	0	0	1	
211	1	1	0	1	0	0	1	0	
212	1	1	0	1	0	0	1	1	
213	1	1	0	1	0	1	0	0	
214	1	1	0	1	0	1	0	1	
215	1	1	0	1	0	1	1	0	
216	1	1	0	1	0	1	1	1	
217	1	1	0	1	1	0	0	0	
218	1	1	0	1	1	0	0	1	
219	1	1	0	1	1	0	1	0	
220	1	1	0	1	1	0	1	1	
221	1	1	0	1	1	1	0	0	
222	1	1	0	1	1	1	0	1	
223	1	1	0	1	1	1	1	0	
224	1	1	0	1	1	1	1	1	
225	1	1	1	0	0	0	0	0	
226	1	1	1	0	0	0	0	1	
227	1	1	1	0	0	0	1	0	
228	1	1	1	0	0	0	1	1	
229	1	1	1	0	0	1	0	0	
230	1	1	1	0	0	1	0	1	
231	1	1	1	0	0	1	1	0	
232	1	1	1	0	0	1	1	1	
233	1	1	1	0	1	0	0	0	
234	1	1	1	0	1	0	0	1	
235	1	1	1	0	1	0	1	0	
236	1	1	1	0	1	0	1	1	
237	1	1	1	0	1	1	0	0	
238	1	1	1	0	1	1	0	1	
239	1	1	1	0	1	1	1	0	
240	1	1	1	0	1	1	1	1	
241	1	1	1	1	0	0	0	0	
242	1	1	1	1	0	0	0	1	
243	1	1	1	1	0	0	1	0	
244	1	1	1	1	0	0	1	1	
245	1	1	1	1	0	1	0	0	
246	1	1	1	1	0	1	0	1	
247	1	1	1	1	0	1	1	0	
248	1	1	1	1	0	1	1	1	
249	1	1	1	1	1	0	0	0	
250	1	1	1	1	1	0	0	1	
251	1	1	1	1	1	0	1	0	
252	1	1	1	1	1	0	1	1	
253	1	1	1	1	1	1	0	0	
254	1	1	1	1	1	1	0	1	
255	1	1	1	1	1	1	1	0	
256	1	1	1	1	1	1	1	1	

Scalars
h cost of unsold item / 5 /
rc reservation cost at the backup supplier /20 /
ec execution cost at the backup supplier /49 /
mu demand mean / 1000 /
sd demand stdev / 50 /
muSP spot market price mean / 240 /
sdSP spot market price stdev / 10 /
telapsed;

Parameter
zSP, pdfSP, cdfSp, delta;
zSP = (ec - muSP) / sdSP;
pdfSP =  exp(-0.5*power(zSp,2))/sqrt(2*3.14156);
cdfSP =  0.5*(1+sqrt(1-exp(-5*power(zSP,2)*0.125)));
If (zSP >= 0, 
         delta = sdSP * pdfSP -  sdSP * zSP *(1-cdfSP);
else  
         delta = sdSP * pdfSP -  sdSP * zSP *(cdfSP);
);

Variables
z(u) service level for scenario u
zKR(u)
expected expected profit;

Positive variables
pdf(u)    pdf for scenario u
cdf(u)    cdf for scenario u
TotalQ(u) total order quantity for scenario u
pdfKR(u)  pdf including KR for scenario u
cdfKR(u)  cdf including KR for scenario u
loss(u)   loss value for Qu scenario u
lossKR(u) loss value for Qu + KR for scenario u
cost(u)   cost scenario u
q(i)      order quantity for supplier i
KR        capacity reserved at the backup supplier;

Equations
objective        define objective function
scenarioCost(u)  scenario cost definition
calcTotalQ(u)    calculate total order for each scenarion
calcLoss(u)      define loss constraint Qu scenario u
calcLossKR(u)    define loss constraint Qu + KR scenario u
calcpdf(u)       calculate pdf of Qu for scenario u
calccdf(u)       calculate cdf of Qu for scenario u
calcpdfKR(u)     calculate pdf of Qu + KR
calccdfKR(u)     calculate cdf of Qu+KR
calcz(u)         calculate z(u)
calczKR(u)       calculate zKR(u);

objective..              expected=e= sum((u), Prob(u)*cost(u));
scenarioCost(u)..        cost(u)=e=  sum((i),c(i)*q(i)*R(u,i))+ rc*KR +
                         h*(TotalQ(u)-mu) + (h+muSP-delta)* loss(u)+ 
                         delta * lossKR(u); 
calcTotalQ(u)..          TotalQ(u) =e=  sum((i), q(i)*R(u,i));
calcLoss(u)..            loss(u)=e=sd*(pdf(u) -z(u)*(1-cdf(u)));
calcLossKR(u)..          lossKR(u) =e= sd*(pdfKR(u) -zKR(u)*(1-cdfKR(u)));
calcpdf(u)..             pdf(u)*sqrt(2*3.14156)=e=exp(-0.5*power(z(u),2));
calccdf(u)..             cdf(u)=e= errorf(z(u));
calcpdfKR(u)..           pdfKR(u)*sqrt(2*3.14156)=e=exp(-0.5*power(zKR(u),2));
calccdfKR(u)..           cdfKR(u)=e= errorf(zKR(u));
calcz(u)..               TotalQ(u)=e=mu+sd*z(u); 
calczKR(u)..             TotalQ(u)+KR=e=mu+sd*zKR(u);
cdf.up(u)=1;
cdf.lo(u)=0;
cdfKR.up(u)=1; 
cdfKR.lo(u)=0;
z.up(u)=20; 
z.lo(u)=-20;
zKR.up(u)=20;
zKR.lo(u)=-20;


Model AONnew / all / ;
option optcr = 1e-5;
option nlp=IPOPT;
option iterlim = 100000000;
option reslim = 5000;
option domlim = 2000000;
solve  AONnew using nlp minimizing expected;



Display AONnew.modelstat;
Display AONnew.solvestat;
telapsed = TimeElapsed;

file  Results storing the results / results_8_Exact_IPOPT.txt / ; 
Results.ap=1;
put Results;
*put /'Objective,Elapsed time','AONnew.solvestat','AONnew.modelstat/;
put /expected.l','telapsed','AONnew.solvestat','AONnew.modelstat/;
putclose Results;
